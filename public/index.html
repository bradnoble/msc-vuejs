<!DOCTYPE html>
<html>

<head>
  <title>{{ title }}</title>
  <!--
  <script src="/js/pouchdb-6.3.4.min.js"></script>
  <script src="/js/pouchdb.find.min.js"></script>
  <script src="/js/pouchdb.silverlining.min.js"></script>
  <script>
    var db = new PouchDB('msc');
  </script>
-->
  <!-- Vue components -->
  <script src="vendor/vue/vue.min.js"></script>
  <script src="vendor/vue/vue-resource.min.js"></script>
  <script src="vendor/vue/vue-router.min.js"></script>
  <script src="vendor/vuex/vuex.min.js"></script>
  <script src="vendor/vue-cookies/vue-cookies.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <!-- <link type="text/css" rel="stylesheet" href="/css/materialize.min.css" media="screen,projection" /> -->
  <link type="text/css" rel="stylesheet" href="vendor/materialize/css/materialize.min.css" media="screen,projection" />
  <!--MSC specific styles-->
  <link type="text/css" rel="stylesheet" href="css/msc.css" />
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
  <div id="app-container">
  </div>

  <!-- SHARED TEMPLATES -->

  <script type="text/x-template" id="layout-template">
    <div>
      <app-navbar></app-navbar>
      <main class="page-background" :class="background">
        <div class="container">
        <router-view></router-view>
        </div>
      </main>
      <app-footer></app-footer>
    </div>
  </script>

  <script type="text/x-template" id="navbar-template">
    <header v-show="isAuthenticated"  class="navbar-fixed">
      <nav>
        <div class="nav-wrapper white black-text">
          <a href="/#/" class="brand-logo">
            <span>&nbsp;&nbsp;</span>
            <img src="img/MSC_Logo_60X60.png">
          </a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <router-link :to="{name:'member-intro'}" tag="li">
              <a>Membership List</a>
            </router-link>
            <router-link to="/resources" tag="li">
              <a>Resources</a>
            </router-link>
            <router-link v-if="isAdmin" :to="{name:'households'}" tag="li">
              <a>Admin</a>
            </router-link>
            <router-link to="/logout" tag="li">
              <a>Logout</a>
            </router-link>
            </li>
          </ul>
        </div>
      </nav>
    </header>
  </script>

  <script type="text/x-template" id="footer-template">
    <div>
    <footer class="page-footer blue lighten-2">
        <div class="container">
        </div>
        <div class="footer-copyright">
          <div class="container">
          <span>&copy; 2018 Montclair Ski Club</span>
          <span class="right">Version 2.00.170</span>
          </div>
        </div>
      </footer>
    </div>  
    </script>

  <script type="text/x-template" id="login-template">
    <div>
      <div class="row">
        <div class="col s5 center-align"><img src="img/MSC_Logo_150X150.jpg"></div>
        <div class="col s5">&nbsp;</div>
      </div>
      <div class="row">
        <div class="col s5">
          <p>The Montclair Ski Club, founded in 1947, is a tightly knit group of avid skiers and their families. Amid the fun of skiing, the club promotes a community atmosphere where cooperation and warm personal relationships are valued. On winter weekends at our 40-bed lodge at the base of Mad River Glen, we enjoy skiing, eating and socializing together. Outside of the ski season we also hold various social activities, in both New Jersey and New England.</p>
          <p>Our 100 active members participate in the running of the club by serving on committees and boards, and by helping to maintain the lodge. MSC is a member of the New Jersey Ski Council and encourages its members to participate in its activities.</p>
        </div>
        <div class="col s1">&nbsp;</div>
        <div class="col s6">
          <div class="row">
            <div class="col">
              <label>Username:</label>
              <input type="text" id="username" v-model="username"/>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <label>Password:</label>
              <input type="password" id="password" v-model="password" @keyup.enter="onLogin"/>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <button class="btn blue" type="button" @click="onLogin">Log In</button>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <p>{{loginMsg}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-template" id="home-template">
    <div>
      <div class="row">
          <div class="col m4 offset-m2">
              <div>&nbsp;</div>
              <div class="card">
                <div class="card-content">
                  <span class="card-title">Quick Access</span>
                  <a href="http://join.me/montclairskiclub" target="_blank">join.me Website for Online Meetings</a>
                  <h6>Resources</h6>
                  <ul>
                  <li>
                  <router-link to="/resources/1zy6dcB1aAiIWCvg05fuX60L2s61ejwyH"><h6><a>Signup Chairs</a></h6></router-link> 
                  </li>
                  <li>
                  <router-link to="/resources/1zy6dcB1aAiIWCvg05fuX60L2s61ejwyH"><h6><a>Lodge Rates</a></h6></router-link>              
                  </li>
                  <li>
                    <router-link to="/resources/1tcUBBGjktzxpzO_ofIPCyH93gHjoc__n"><h6><a>join.me Call &amp; Video Info</a></h6></router-link>
                  </li>
                  <li>
                  <router-link to="/resources/1qqFt70tPY-zL3wzEFg5F3yE481AaIv22"><h6><a>Newsletters</a></h6></router-link>              
                  </li>
                  <li>
                  <router-link to="/resources/1kLCc0HNuQEXnkUlu9Fcm5d5tSb2kX4eD"><h6><a>Meeting Minutes</a></h6></router-link>              
                  </li>
                  <li>
                  <router-link to="/resources/10BN8b-oKJv-8v8ZrNkDdN-Z4DfSx9eFc"><h6><a>Financial Reports</a></h6></router-link>              
                  </li>
                  </ul>
                  <h6>Membership</h6>
                  <ul>
                  <li>
                  <router-link to="/members/status/active"><h6><a>Active Members</a></h6></router-link> 
                  </li>
                </div>
              </div>
        </div>
        <div class="col m4">
          <div>&nbsp;</div>
          <div>
            <div id="twitter-timeline"></div>
          </div>
        </div>
      </div>
    </div>
  </script>

  <!-- HOUSEHOLD VIEWS -->

  <!-- IS USED??? a list of people in the household -->
  <script type="text/x-template" id="first-child">
    <div>
      <ul class="collection" v-show="item.people.length > 0">
        <household-person 
          v-for="person in item.people" 
          v-bind:key="person._id" 
          v-bind:item="person">
        </household-person>                
      </ul>
      <p v-if="item.people.length == 0">
        <router-link :to="{ name: 'newPerson', params: { household_id: item._id }}" class="btn">
          <i class="material-icons">person_add</i> Add a person
        </router-link>
      </p>
    </div>
  </script>

  <!-- parent view for each household -->
  <script type="text/x-template" id="household">
    <div>

      <loading :status="loading"></loading>
      <error :error="error"></error>

      <div v-if="!error">
        <h6>
          <router-link :to="{name: 'households'}">Admin</router-link> / {{ item.name }}
        </h6>
        <div class="row">
          <div class="col s12 m10">
            <div class="card">
              <div class="card-content">
                <span class="card-title">
                    {{ item.name }}
                    <span v-if="$route.name != 'person-edit' && $route.name != 'person-new' && $route.name != 'household-edit'">
                      <!-- Dropdown Trigger -->
                      <span class="secondary-content">
                        <a class="dropdown-trigger" href="#" data-target="dropdown1" data-constrainwidth="false" data-alignment="right" title="click to see options">
                          <i class="material-icons small">more_horiz</i>
                        </a>
                      </span>
                      <!-- Dropdown Structure -->
                      <ul id="dropdown1" class="dropdown-content">
                        <li>
                          <router-link :to="{ name: 'person-new', params: { household_id: item._id }}" title="Add a person to this household">
                            <i class="material-icons">person_add</i> Add a person
                          </router-link>
                        </li>
                        <li>
                          <router-link :to="{ name: 'household-edit', params: { household_id: item._id }}" title="Edit household">
                            <i class="material-icons">edit</i> Edit household
                          </router-link>
                        </li>
                      </ul>
                    </span><!-- route guard -->
                </span><!-- card title -->
                <location v-bind:item="item"></location>
    
                <router-view :item="item"></router-view>
              </div>
            </div><!-- card -->
          </div><!-- col -->          
        </div><!--row-->
      </div><!--!error-->
      <a href="#/households">&larr; Back to Admin</a>
    </div><!-- container -->
  </script>

  <!-- a form to edit a household -->
  <script type="text/x-template" id="household-edit">
    <div>
      <form id="form-edit-household" name="form-edit-household" v-on:submit="save" action="#" method="post">
        <div class="card-content grey lighten-4">
          <span class="card-title">{{ title.content }}</span>
          <form-errors :errors="errors"></form-errors>
          <div class="row">
            <div class="input-field col m4 s12">
              <input type="text" id="household_name" v-model="item.name" class="validate" />
              <label for="household_name" class="active">Household name</label>
              <span class="helper-text red-text text-darken-2">Required</span>
            </div>
            <div class="input-field col m8 s12">
              <input type="text" id="household_label_name" v-model="item.label_name"  />
              <label for="household_label_name" class="active">Mailing label name</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col m8 s12">
              <input type="text" id="household_street1" v-model="item.street1"  />
              <label for="household_street1" class="active">Street 1</label>
            </div>
            <div class="input-field col m4 s12">
              <input type="text" id="household_street2" v-model="item.street2"  />
              <label for="household_street2" class="active">Street 2</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col m6 s12">
              <input type="text" id="household_city" v-model="item.city"  />
              <label for="household_city" class="active">City</label>
              <span class="helper-text red-text text-darken-2">Required</span>
            </div>
            <div class="input-field col m2 s12">
              <input type="text" id="household_state" v-model="item.state"  />
              <label for="household_state" class="active">State</label>
              <span class="helper-text red-text text-darken-2">Required</span>
            </div>
            <div class="input-field col m4 s12">
              <input type="text" id="household_zip" v-model="item.zip"  />
              <label for="household_zip" class="active">ZIP</label>
              <span class="helper-text red-text text-darken-2">Required</span>
            </div>
          </div>
          <div class="input-field">              
            <input type="text" id="household_phone" v-model="item.phone"  />
            <label for="household_phone" class="active">Household Phone</label>
          </div>
          <div class="section">
            <h5>
              Hardcopies
            </h5>
          </div>
          <div class="row">              
            <div class="col m6 s12 switch">
              Mail a hardcopy of the newsletter?<br />
              <label>
                No
                <input type="checkbox" id="mail_news" v-model="item.mail_news">
                <span class="lever"></span>
                Yes
              </label>
            </div>
            <div class="col m6 s12 switch">
              Mail a hardcopy of the membership list?<br />
              <label>
                No
                <input type="checkbox" id="mail_list" v-model="item.mail_list">
                <span class="lever"></span>
                Yes
              </label>
            </div>
          </div><!--row-->
        </div><!--card content-->
        <div class="card-content red lighten-4" v-if="$route.params.household_id">
          <p>
            <label  class="red-text text-darken-2">
              <input type="checkbox" v-model="item._deleted" />
              <span>Remove this household</span>
            </label>
          </p>
          <p>
            Only remove households that have been added in error. Deleting the household deletes the people in the household, too. This can not be undone.
          </p>
        </div><!-- card-content -->
        <div class="card-action grey lighten-4">
          <input type="hidden" v-model="item.household_id"  />
          <button id="save" class="btn btn-large waves-effect waves-light" type="submit" name="action">Submit</button>
          <router-link v-if="$route.name == 'editHousehold'" :to="{name: 'admin-household', params: {id: item._id}}" class="waves-effect waves-light btn-flat grey-text" title="cancel changes, and return to the list">Cancel</router-link>
          <router-link v-if="$route.name == 'new-household'" :to="{name: 'admin'}" class="waves-effect waves-light btn-flat grey-text" title="cancel changes, and return to the list">Cancel</router-link>
        </div>
      </form>
    </div>
  </script>

  <!-- a form to add a new household -->
  <script type="text/x-template" id="household-new">
    <div>        
      <h6>
        <a href="#/households">Admin</a> / Add a household
      </h6>
      <div class="row">
        <div class="col s12 m8">
          <div class="card">
            <div class="card-content">
              <span class="card-title">
                Add household
              </span>
              <router-view :item="item"></router-view>
            </div><!--card-content-->
          </div><!--card-->
        </div><!--col-->
      </div><!--row-->
    </div>
  </script>

  <script type="text/x-template" id="household-person">
    <div class="collection-item avatar">
      <i class="material-icons circle green">person</i>
      <span class="title">
        <person-name :item="item"></person-name>
      </span>
      <p>
        <person-contact-info :item="item"></person-contact-info>
      </p>
      <router-link :to="{ name: 'person-edit', params: {household_id: item.household_id, person_id: item._id }}" class="">
        <span class="secondary-content"><i class="material-icons">edit</i></span>
      </router-link>
    </div>
  </script>

  <script type="text/x-template" id="households">
    <div>
      <h6>
        Admin
      </h6>
      <div v-if="!loading">
        <ul class="collection">
          <li class="collection-item grey lighten-4 row">
            <div class="input-field col m8 s12">
              <i class="material-icons prefix">search</i>
              <input id="search" v-model="searchStr" @keyup="search()" placeholder="First or last name..." />
              <label for="search" class="active">Search by household name or first/last name of a person in the household </label>
            </div>            
            <div class="col m4">
              <router-link :to="{name:'household-new'}" class="btn right">
                <i class="material-icons">add_location</i> Add household
              </router-link>
            </div>
          </li>
          <li v-for="(item, index) in items" :key="item._id" v-if="!item.hide" class="collection-item">
            <h5>
              {{ item.name }}
              <!-- Dropdown Trigger -->
              <span class="secondary-content">
                <a class="dropdown-trigger" href="#" :data-target="item._id" data-constrainwidth="false" data-alignment="right" title="click to see options">
                  <i class="material-icons small">more_horiz</i>
                </a>
              </span>
              <!-- Dropdown Structure -->
              <ul :id="item._id" class="dropdown-content">
                <li>
                  <router-link :to="{ name: 'person-new', params: { household_id: item._id }}" title="Add a person to this household">
                    <i class="material-icons">person_add</i> Add a person
                  </router-link>
                </li>
                <li>
                  <router-link :to="{ name: 'household-edit', params: { household_id: item._id }}" title="Edit household">
                    <i class="material-icons">edit</i> Edit household
                  </router-link>
                </li>
              </ul>
            </h5>
            <div class="row">
              <div class="col m3">
                <location :item="item"></location>
              </div>
              <div class="col m9">
                <ul class="collection">
                    <household-person 
                    v-for="person in item.people" 
                    v-bind:key="person._id" 
                    v-bind:item="person">
                  </household-person>
                </ul>
              </div>
            </div><!--row-->
          </li>
        </ul>
      </div>
      <div v-else class="progress">
          <div class="indeterminate"></div>
      </div>
    </div>
  </script>

  <!-- MEMBERS VIEWS -->

  <script type="text/x-template" id="members">
    <div>
      <router-view @searched="search" :statuses="statuses" :searchstring="searchstring"></router-view>
    </div>
  </script>

  <script type="text/x-template" id="member-intro">
    <div>
      <h5>
        Membership List
      </h5>
      <form action="#" @submit="searchfromchild">
        <div class="row">
          <div class="input-field col m11 s11">
            <input id="search" v-model="searchstring" type="text" />
            <label for="search">Search by name</label>
          </div>
          <div class="input-field col m1 s1">
            <button class="btn waves-effect waves-light" type="submit" name="action"><i class="material-icons" title="search">search</i></button>
          </div>
        </div>
      </form>

      <div class="row">
        <div class="col m8 s12">
          <h5>
            Membership
          </h5>
          <div class="row">
            <div class="col m6 s12" v-for="status in items">

              <div class="card blue">
                <div class="card-content white-text">
                  <span class="card-title">
                    {{ status.key }}
                    <span class="right">
                      {{ status.value }}
                    </span>
                  </span>
                </div>
                <div class="card-action blue darken-2">
                  <router-link :to="{name: 'member-status', params:{ status:status.key}}" :title="'View all ' + status.key + ' members'" class="">
                    <i class="material-icons small">search</i>
                  </router-link>
                  <router-link :to="{name: 'member-emails', query:{ status:status.key}}" :title="'View ' + status.key + ' emails'" class="">
                    <i class="material-icons small">email</i>
                  </router-link>    
                </div>
              </div>

            </div>
            <div class="col m12 s12">
              <div class="card blue">
                <div class="card-content white-text">
                  <span class="card-title">
                    total
                    <span class="right">
                      {{ total }} 
                    </span>
                  </span>
                </div>
                <div class="card-action blue darken-2">
                  <router-link :to="{name:'member-status', params:{ status:'all' }}">
                    <i class="material-icons small">search</i>      
                  </router-link>
                  <router-link :to="{name: 'member-emails', query:{ status:statuses}}">
                    <i class="material-icons small">email</i>
                  </router-link>              
                </div>
              </div>
            </div>
          </div>
          <!-- doughnut chart commented out for now -->
          <!-- <canvas id="myChart"></canvas> -->
        </div>
        <div class="col m4 s12">
          <h5>Recent updates</h5>
          <ol>
            <li v-for="update in updates">

              <div v-show="update.doc.type == 'household'">
                <router-link :to="{name:'member-household', params:{ id:update.id }}">{{ update.doc.name }}</router-link>
                <location v-bind:item="update.doc"></location>
              </div>

              <div v-show="update.doc.type == 'person'">
                <router-link :to="{name:'member-household', params:{ id:update.doc.household_id }}">
                  <person-name v-bind:item="update.doc"></person-name>
                </router-link>
              </div>
  
            </li>
          </ol>
        </div>
      </div>
    </div>
  </script>

  <!--search results, child of list-->
  <script type="text/x-template" id="member-search">
  <div>
    <h5>
      <router-link :to="{name: 'member-intro'}">Membership List</router-link> / Search
    </h5>
    <form action="#" @submit="searchfromchild">
      <div class="row">
        <div class="input-field col m11 s11">
          <input id="search" v-model="searchstring" type="text" />
          <label for="search">Search by name</label>
        </div>
        <div class="input-field col m1 s1">
          <button class="btn waves-effect waves-light" type="submit" name="action"><i class="material-icons" title="search">search</i></button>
        </div>
      </div>
    </form>

    <!--
    <div class="input-field">
      <span class="prefix">
        <i class="material-icons" v-if="searchstring" v-on:click="clearfromchild" title="clear the search input">clear</i>
        <i class="material-icons" v-if="!searchstring" title="search">search</i>
      </span>
      <input id="search" v-model="searchstring" @keyup.enter="search" type="text" />
      <label for="search">Search by name</label>
    </div>
    -->

    <div class="row">
      <div class="col m3">
        <p>
          View members by status
        </p>
        <div class="collection facets">
          <router-link :to="{name:'member-status', params:{ status:'all' }}" class="collection-item" :class="{active: $route.params.status == 'all'}">
            all
            <span class="secondary-content" v-if="$route.params.status == 'all'">
              <i class="material-icons">chevron_right</i>
            </span>
          </router-link>              
          <router-link :to="{name:'member-status', params:{ status:status }}" v-if="status != 'deceased'" v-for="status in statuses" class="collection-item" :class="{active: $route.params.status == status}">
            {{ status }}
            <span class="secondary-content" v-if="$route.params.status == status">
              <i class="material-icons">chevron_right</i>
            </span>
          </router-link>
        </div>
      </div>
      <div class="col m9">
        <loading :status="loading"></loading>
        <div v-if="!loading">
          <p v-if="$route.params.status">
            <span>{{ items.length }} {{ $route.params.status }}(s)</span>
            <span v-if="isAdmin">
              <a class="dropdown-trigger" href="#" data-target="actions" data-constrainwidth="false" data-alignment="right" title="View CSV file and email options">
                <i class="material-icons small">more_horiz</i>
              </a>
              <!-- Dropdown Structure -->
              <ul id="actions" class="dropdown-content">
                <li>
                  <a v-bind:href="'/api/member/csv?status=' + $route.params.status">
                    <i class="material-icons">file_download</i> Download (CSV)
                  </a>
                </li>
                <li>
                  <router-link :to="{name: 'member-emails', query: {status: $route.params.status }}" v-if="$route.params.status != 'all'">
                    <i class="material-icons">email</i> Get emails for {{ $route.params.status }}(s)
                  </router-link>
                  <router-link v-else :to="{name: 'member-emails'}">
                    <i class="material-icons">email</i> Get emails for all
                  </router-link>
                </li>
              </ul>
            </span>
          </p>
          <p v-if="$route.query.q">
            {{ items.length }} result(s) 
          </p>
        </div>

        <ul class="collection" v-if="!loading">
          <li class="collection-item row" v-for="item in items" v-bind:id="item._id">

            <div class="col m5">
              <person-name :item="item"></person-name>
            </div>
            <div class="col m6">
              <person-contact-info :item="item"></person-contact-info>
            </div>
            <div class="col m1">
              <span class="secondary-content" v-if="item.household_id">
                <!-- protected by v-if b/c https://github.com/vuejs/vue-router/issues/986 -->
                <router-link :to="{ name: 'member-household', params: { id: item.household_id } }" title="View household" class="btn btn-flat btn-small waves-effect waves-teal teal-text">
                  <i class="material-icons tiny">home</i>
                </router-link>  
              </span>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
  </script>

  <!-- second child of list view -->
  <script type="text/x-template" id="member-emails">
    <div>
      <h5>
        <router-link :to="{name: 'member-intro'}">Membership List</router-link> / Emails
      </h5>      
      <div class="">
          <div class="row">
            <div class="col m3">
              <div class="section">
                <p>
                  Group filters
                </p>
                <div class="">
                  <p>
                    <router-link :to="{query: { status: newsletter }}" class="btn-small" :title="'emails for ' + newsletter">Newsletter emails</router-link>
                  </p>
                  <p>
                    <router-link :to="{query: { status: statuses }}" class="btn-small" :title="'emails for ' + statuses">All emails</router-link>
                  </p>
                </div>  
                <div v-if="query_array.length != statuses.length">
                  <p>
                    Status filters
                  </p>
                  <div>
                    <a v-for="status in statuses" @click.prevent="intercept(status)" href="#" class="chip" v-if="!query_array.includes(status)">
                      <i class="material-icons tiny">add</i>
                      {{ status }}
                    </a>
                  </div>
                </div> 
              </div>
            </div>

            <div class="col m9">
              <div class="section">
                  <div v-if="query_array.length > 0">
                      <p>
                        Selected filters | 
                        <a @click.prevent="intercept()" href="#">
                            <i class="material-icons tiny">clear</i>
                            Clear all
                          </a>
                          </p>
                      <div class="">
                        <a @click.prevent="intercept(status)" href="#" v-for="status in query_array" class="chip blue lighten-5 blue-text" title="remove this filter">
                          <i class="material-icons tiny">clear</i>
                          {{ status }}
                        </a>
                      </div>
                    </div>                
                <p class="hide">
                  <b>{{totalEmails}} selected: {{ querystring }}</b>
                </p>
                <loading :status="loading"></loading>
                <div v-if="!loading">
                  <form>
                    <div class="input-field">
                      <textarea id="textarea-emails" v-model="items" class="materialize-textarea">{{ items }}</textarea>
                    </div>
                  </form>
                </div>
              </div>
            </div><!-- col -->
          </div><!-- row -->
          <router-link :to="{name: 'member-intro'}">Back to the list</router-link>
        </div><!--card panel-->    

    </div>
  </script>

  <script type="text/x-template" id="member-household">
        <div>
          <h5>
            <router-link :to="{name: 'member-intro'}">Membership List</router-link> / {{ item.label_name }}
          </h5>
          <div class="card">
            <div class="card-content">
              <span class="card-title">
                {{ item.label_name }}
              </span>
              <location v-bind:item="item"></location>
              <ul class="collection">
                <person 
                  v-for="person in item.people" 
                  v-bind:key="person._id" 
                  v-bind:item="person">
                </person>
              </ul>
            </div>
          </div>
          <div class="">
            <router-link :to="back">&larr; Back</router-link>
          </div>
        </div>
  </script>

  <!-- PERSON VIEWS -->

  <!-- a form to edit a person in the household -->
  <script type="text/x-template" id="person-edit">
      <div>
  
          <form id="form-edit-person" name="form-edit-person" v-on:submit="save" action="#" method="post">
            <div class="card-content blue lighten-5">
        
              <span class="card-title">{{ title.content }}</span>
  
              <form-errors :errors="errors"></form-errors>
  
              <div class="row">
                <div class="input-field col m6 s12">              
                  <input type="text" id="item_first" v-model="person.first" type="text" class="validate" />
                  <label for="item_first" class="active">First name</label>
                  <span class="helper-text red-text text-darken-2">Required</span>
                </div>
                <div class="input-field col m6 s12">              
                  <input type="text" id="item_last" v-model="person.last" type="text" class="validate" />
                  <label for="item_last" class="active">Last name</label>
                  <span class="helper-text red-text text-darken-2">Required</span>
                </div>
              </div>
              <div class="row">
                <div class="input-field col m12 s12">              
                  <input type="text" id="item_email" v-model="person.email" type="email" class="validate"  />
                  <label for="item_email" class="active">Email</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s6">              
                  <input type="text" id="item_phone" v-model="person.phone" type="text" class="validate" />
                  <label for="item_phone" class="active">Mobile phone</label>
                </div>
                <div class="input-field col s6">              
                  <input type="text" id="item_work_phone" v-model="person.work_phone" type="text" class="validate" />
                  <label for="item_work_phone" class="active">Work phone</label>
                </div>
              </div>
              <div class="row">
                <div class="col m6 s12">              
                  <p>
                    Membership status
                  </p>
                  <p v-for="(value, idx) in statuses">
                    <label v-bind:for="person._id + '-' + idx">
                      <input 
                        type="radio" 
                        :name="person._id + '-' + idx" 
                        :id="person._id + '-' + idx" 
                        :value="value" 
                        v-model="person.status" 
                        class="with-gap"
                      />
                      <span>{{ value }}</span>
                    </label>
                  </p>                
                </div>
                <div class="col m6 s12">              
                  <p>Gender</p>
                  <p v-for="(value, index) in genders">
                    <label :for="person._id + '-gender-' + index">
                      <input type="radio" 
                        :name="person._id + '-gender-' + index" 
                        :id="person._id + '-gender-' + index" 
                        :value="value" 
                        v-model="person.gender" 
                        class="with-gap"
                      />
                      <span>{{ value }}</span>
                    </label>
                  </p>                
                </div>
              </div><!-- row -->    
  
            </div><!--card-content-->
            <div v-if="$route.name != 'newPerson'" class="card-content red lighten-4">
              <p>
                <label v-on:click="removePerson()" class="red-text text-darken-2">
                  <input type="checkbox" v-bind:id="person._id" v-model="person._deleted" />
                  <span>Remove this person</span>
                </label>
              </p>
              <p>
                Only remove someone who has been added in error. This can not be undone.
              </p>
            </div><!-- card-content -->
  
            <div class="card-action grey lighten-4">
              <input type="hidden" v-model="person.household_id"  />
              <button id="save" class="btn btn-large waves-effect waves-light" type="submit">Submit</button>
              <router-link :to="{name: 'admin-household', params: {household_id: person.household_id}}" class="waves-effect waves-light btn-flat grey-text" title="cancel changes, and return to the list">Cancel</router-link>
            </div>
  
          </form>
  
      </div>
    </script>

  <!-- RESOURCES VIEWS-->

  <!--Resources (Google Drive)-->
  <script type="text/x-template" id="resources">
    <div>
      <div class="row">
        <div class="col s12">
        </div>
      </div>
      <div class="row">
        <div class="col s12">
          <h5>Resources&nbsp;<i class="material-icons small cursor-pointer hoverable" @click="onHelp($event)">help_outline</i></h5>
        </div>
      </div>
      <div id="resourcesHelp" class="row">
        <div class="col s12">
            <p>Resources files are organized in folders by topic. PDF files can be viewed and all files can be downloaded.</p>
            <ul>
              <li><i class="material-icons">chevron_right</i>Select a folder to display the files and additional folders contained in it.</li>
              <li><i class="material-icons">chevron_right</i>Select a PDF file to view the contents.</li>
              <li><i class="material-icons">chevron_right</i>Click the <i class="material-icons">file_download</i> icon to download a file.</li>
              <li><i class="material-icons">chevron_right</i>Use the breadcrumbs at the top of the list tomove up in the folder hierarchy.</li>
            </ul>
            <a class="waves-effect waves-light btn blue" @click="onHelp($event)"><i class="material-icons left">arrow_drop_up</i>Close</a>
        </div>
      </div>
            <!-- <div class="row"> -->
        <!-- <div class="col s12">
          <h5>Resources&nbsp;<i class="material-icons small waves-effect waves-light btn modal-trigger" href="resourcesHelpmodal">help_outline</i></h5>
        </div> -->
        <!-- <div class="col s8">
          <nav class="grey lighten-4">
            <div class="nav-wrapper">
              <form>
                <div class="input-field">
                  <input id="search" type="search" placeholder="Search resources"  v-on:keyup.enter="onSearch($event)" required>
                  <label class="label-icon" for="search"><i class="material-icons  black-text">search</i></label>
                  <i class="material-icons">close</i>
                </div>
              </form>
            </div>
          </nav>
        </div> -->
      <!-- </div> -->
      <nav class="blue darken-2">
        <div class="nav-wrapper">
          <div class="col s12">
            <span v-for="folder in path" @click="onBreadcrumb(folder.id, $event)" class="breadcrumb cursor-pointer">{{folder.name}}</span>
          </div>
        </div>
      </nav>
      <div class="row">
        <div class="col s12">
          <div class="divider"></div>
        </div>
      </div>
      <div v-if="files.length==0">
        <div class="row">
            <div class="col s12"><i class="material-icons small">info_outline</i><span>&nbsp;No files in this folder</span></div>
        </div>
      </div>
      <div v-else>
        <div class="row grey lighten-4">
          <div class="col s5">Name</div>
          <div class="col s1">Type</div>
          <div class="col s2">Modified</div>
          <div class="col s2">Size</div>
          <div class="col s1"></div>
        </div>
        </div>
        <div class="row"  v-for="file in files" :key="file.id" v-if="file.type=='Folder'">
          <div class="col s5" @click="onFolderView(file,$event)"><i class="material-icons small cursor-pointer">folder</i><span class="cursor-pointer">&nbsp;{{file.name}}</span></div>
          <div class="col s1">&minus;</div>
          <div class="col s2">&minus;</div>
          <div class="col s2">&minus;</div>
          <div class="col s1"></div>
        </div>
        <div class="row"  v-for="file in files" :key="file.id" v-if="file.type!='Folder'">
          <div class="col s5" v-bind:class="{'cursor-pointer':file.type=='PDF','hoverable':file.type=='PDF'}" @click="(file.canView?onFileView(file, $event):null)"><i class="material-icons small">{{(file.type=='PDF'?'description':(file.type=='Spreadsheet'?'grid_on':'format_align_left'))}}</i><span>&nbsp;{{file.name + (!file.canView?'&nbsp;(Download only)':'')}}</span></div>
          <div class="col s1">{{file.type}}</div>
          <div class="col s2">{{file.modifiedTimeFormatted}}</div>
          <div class="col s2" v-html="file.sizeFormatted"></div>
          <div class="col s1"><i v-if="file.canDownload" class="material-icons small cursor-pointer hoverable" @click="onFileDownload(file, $event)">file_download</i></div>
        </div>
      </div>
    </div>
  </script>

  <!--Resources: PDF viewer for Google Docs-->
  <div id="pdfModal" class="modal">
    <iframe id="pdfViewer" name="pdfViewer" src="vendor/pdfjs/web/viewer.html" allowfullscreen="true"
      webkitallowfullscreen=""></iframe>
  </div>

  <!--SHARED VIEWS-->
  <script type="text/x-template" id="error">
    <div v-if="error">
      <div class="alert error card">
        <div class="card-content red white-text">
          <p>
            <i class="material-icons">error</i> {{ error }}
          </p>
        </div>      
      </div>
      <div class="card">
        <div class="card-content">
          <span class="card-title">
            Error Details
          </span>
          <p>
            If you are getting this error and you don't know why, copy this stuff and send it to Brad Noble:
          </p>
          <pre>Path: {{ $route.path }}
  Parameters:
  {{ $route.params }}</pre>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-template" id="loading">
      <div v-if="status" >
        <div class="progress">
          <div class="indeterminate"></div>
        </div>
      </div>
    </script>

  <script type="text/x-template" id="form-errors">
      <div v-if="errors.length > 0">
        <ul class="errors">
          <li v-for="error in errors" class="red-text text-darken-2">
            <i class="material-icons red-text text-darken-2">error</i> {{ error }}
          </li>
        </ul>
      </div>
    </script>

  <!-- WHAT ARE THESE VIEWS? -->
  <!-- these are views that function like includes -->
  <!-- they go to work all over the place -->

  <script type="text/x-template" id="view-location">
    <span>
      <!-- <i class="material-icons small">home</i> -->
      <!-- <span v-if="item.label_name"><b>{{ item.label_name}}</b><br /></span> -->
      <span v-if="item.street1">{{ item.street1 }}, </span>
      <span v-if="item.street2">{{ item.street2 }}, </span>
      <span v-if="item.city">{{ item.city }}, </span> 
      <span v-if="item.state">{{ item.state }}, </span> 
      <span v-if="item.zip">{{ item.zip }}</span> 
      <span v-if="item.phone"> | Home phone: {{ item.phone }}</span> 
    </span>
  </script>

  <script type="text/x-template" id="view-person">
    <li class="row collection-item">
      <div class="col m6"><person-name :item="item"></person-name></div>
      <div class="col m6"><person-contact-info :item="item"></person-contact-info></div>
    </li>
  </script>

  <script type="text/x-template" id="view-person-name">
    <span>
      <span class="name">{{ item.last }}, {{ item.first }}</span>
      <span class="person-status grey-text">{{ item.status }}</span>
    </span>
  </script>

  <script type="text/x-template" id="view-person-contact-info">
  <span>
    <div v-if="item.email" class="nowrap"><i class="material-icons tiny grey-text">email</i>&nbsp;{{ item.email }}</div>
    <div v-if="item.phone" class="nowrap"><i class="material-icons tiny grey-text">phone_iphone</i>&nbsp;{{ item.phone }}</div>
    <div v-if="item.work_phone" class="nowrap"><i class="material-icons tiny grey-text">work</i>&nbsp;{{ item.work_phone }}</div>
  </span>
  </script>

  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="vendor/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="vendor/materialize/js/materialize.min.js"></script>
  <!--PDF viewer for Resources-->
  <script type="text/javascript" src="vendor/pdfjs/build/pdf.js"></script>
  <script type="text/javascript" src="vendor/pdfjs/web/viewer.js"></script>
  <!--Twitter widget loader-->
  <script type="text/javascript" src="vendor/twitter-widgets/index.js"></script>
  <!--MSC-->
  <script type="text/javascript" src="factories.js"></script>
  <script type="text/javascript" src="routes.js"></script>
  <script type="text/javascript" src="main.js"></script>
</body>

</html>