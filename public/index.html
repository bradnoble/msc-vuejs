<!DOCTYPE html>
<html>

<head>
  <title>{{ title }}</title>

  <!-- Vue components -->
  <script src="vendor/vue/vue.js"></script>
  <script src="vendor/vue/vue-resource.min.js"></script>
  <script src="vendor/vue/vue-router.min.js"></script>
  <script src="vendor/vuex/vuex.min.js"></script>
  <script src="vendor/vue-cookies/vue-cookies.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <!-- <link type="text/css" rel="stylesheet" href="/css/materialize.min.css" media="screen,projection" /> -->
  <link type="text/css" rel="stylesheet" href="vendor/materialize/css/materialize.min.css" media="screen,projection" />
  <!--MSC specific styles-->
  <link type="text/css" rel="stylesheet" href="css/msc.css" />
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
  <div id="app-container">
  </div>

  <!-- SHARED TEMPLATES -->

  <script type="text/x-template" id="layout-template">
    <div>
      <app-navbar></app-navbar>
      <main class="page-background" :class="background">
        <div class="container">
        <router-view></router-view>
        </div>
      </main>
      <app-footer></app-footer>
    </div>
  </script>

  <script type="text/x-template" id="navbar-template">
    <header v-show="isAuthenticated">
      <nav>
        <div class="nav-wrapper navbar-fixed white black-text">
          <a href="/#/" class="brand-logo">
            <img src="img/MSC_Logo_60X60.png">
          </a>
          <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
          <ul class="right hide-on-med-and-down">
            <router-link :to="{name:'member-intro'}" tag="li">
              <a>Membership List</a>
            </router-link>
            <router-link :to="{name:'resources'}" tag="li">
              <a>Resources</a>
            </router-link>
            <router-link v-if="isAdmin" :to="{name:'admin'}" tag="li">
              <a>Admin</a>
            </router-link>
            <router-link :to="{name:'logout'}" tag="li">
              <a>Logout</a>
            </router-link>
          </ul>
        </div>
      </nav>
      <ul class="sidenav" id="mobile-demo">
        <router-link :to="{name:'home'}" tag="li" class="sidenav-close">
          <a>MSC Home</a>
        </router-link>
        <router-link :to="{name:'member-intro'}" tag="li" class="sidenav-close">
          <a>Membership List</a>
        </router-link>
        <router-link :to="{name:'resources'}" tag="li" class="sidenav-close">
          <a>Resources</a>
        </router-link>
        <router-link v-if="isAdmin" :to="{name:'admin'}" tag="li" class="sidenav-close">
          <a>Admin</a>
        </router-link>
        <router-link :to="{name:'logout'}" tag="li" class="sidenav-close">
          <a>Logout</a>
        </router-link>
      </ul>
    </header>
  </script>

  <script type="text/x-template" id="footer-template">
    <div>
    <footer class="page-footer blue lighten-2">
        <div class="container">
        </div>
        <div class="footer-copyright">
          <div class="container">
          <span>&copy; 2018 Montclair Ski Club</span>
          <span class="right">Version 2.00.200</span>
          </div>
        </div>
      </footer>
    </div>  
    </script>

  <script type="text/x-template" id="login-template">
    <div>
      <div class="row">
        <div class="col s5 center-align"><img src="img/MSC_Logo_150X150.jpg"></div>
        <div class="col s5">&nbsp;</div>
      </div>
      <div class="row">
        <div class="col s5">
          <p>The Montclair Ski Club, founded in 1947, is a tightly knit group of avid skiers and their families. Amid the fun of skiing, the club promotes a community atmosphere where cooperation and warm personal relationships are valued. On winter weekends at our 40-bed lodge at the base of Mad River Glen, we enjoy skiing, eating and socializing together. Outside of the ski season we also hold various social activities, in both New Jersey and New England.</p>
          <p>Our 100 active members participate in the running of the club by serving on committees and boards, and by helping to maintain the lodge. MSC is a member of the New Jersey Ski Council and encourages its members to participate in its activities.</p>
        </div>
        <div class="col s1">&nbsp;</div>
        <div class="col s6">
          <div class="row">
            <div class="col">
              <label>Username:</label>
              <input type="text" id="username" v-model="username"/>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <label>Password:</label>
              <input type="password" id="password" v-model="password" @keyup.enter="onLogin"/>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <button class="btn blue" type="button" @click="onLogin">Log In</button>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <p>{{loginMsg}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-template" id="home-template">
    <div>
      <div class="row">
          <div class="col m4 offset-m2">
              <div>&nbsp;</div>
              <div class="card">
                <div class="card-content">
                  <span class="card-title">Quick Access</span>
                  <a href="http://join.me/montclairskiclub" target="_blank">join.me Website for Online Meetings</a>
                  <router-link to="/resources/-1"><h6><a>Website Guide</a></h6></router-link> 
                  <h6>Resources</h6>
                  <ul>
                  <li>
                  <router-link to="/resources/1zy6dcB1aAiIWCvg05fuX60L2s61ejwyH"><h6><a>Signup Chairs</a></h6></router-link> 
                  </li>
                  <li>
                  <router-link to="/resources/1zy6dcB1aAiIWCvg05fuX60L2s61ejwyH"><h6><a>Lodge Rates</a></h6></router-link>              
                  </li>
                  <li>
                    <router-link to="/resources/1tcUBBGjktzxpzO_ofIPCyH93gHjoc__n"><h6><a>join.me Call &amp; Video Info</a></h6></router-link>
                  </li>
                  <li>
                  <router-link to="/resources/1qqFt70tPY-zL3wzEFg5F3yE481AaIv22"><h6><a>Newsletters</a></h6></router-link>              
                  </li>
                  <li>
                  <router-link to="/resources/1kLCc0HNuQEXnkUlu9Fcm5d5tSb2kX4eD"><h6><a>Meeting Minutes</a></h6></router-link>              
                  </li>
                  <li>
                  <router-link to="/resources/10BN8b-oKJv-8v8ZrNkDdN-Z4DfSx9eFc"><h6><a>Financial Reports</a></h6></router-link>              
                  </li>
                  </ul>
                  <h6>Membership</h6>
                  <ul>
                  <li>
                  <router-link to="/members/status/active"><h6><a>Active Members</a></h6></router-link> 
                  </li>
                </ul>
                </div>
              </div>
        </div>
        <div class="col m4">
          <div>&nbsp;</div>
          <div>
            <div id="twitter-timeline"></div>
          </div>
        </div>
      </div>
    </div>
  </script>



<!-- ADMIN VIEWS -->

<script type="text/x-template" id="admin">
  <div>
      <div class="row">
          <div class="col s12">
            <p class="breadcrumbs">
              <span v-for="route in $route.matched">
                  <span v-if="route.name != $route.name">
                    <router-link :to="{name: route.name}">
                      {{ route.meta.breadcrumb }}
                    </router-link> / 
                  </span>
                  <span v-else>
                    <b>{{ route.meta.breadcrumb }}</b>
                  </span>
              </span>              
            </p>
          </div><!--col-->
        </div><!--row-->
  

        <form action="#" @submit="search" v-if="searchForm">
          <div class="row">
            <div class="input-field col m11 s9">
              <input id="search" v-model="searchstring" type="text" />
              <label for="search">Search by name</label>
            </div>
            <div class="input-field col m1 s3">
              <button class="btn waves-effect waves-light" type="submit" name="action">
                <i class="material-icons" title="search">search</i>
              </button>
            </div>
          </div>
        </form>

    <error :error="error"></error>
    <loading :status="loading"></loading>

    <router-view 
      @setSearchString="setSearchString" 
      @clicked="clickedFromChild"
      @loading="loadingCheck"
      @error="errorMsg"
      @searchForm="toggleSearchForm"
      >
    </router-view>
  </div>
</script>

<script type="text/x-template" id="admin-intro">
  <div class="row">

      <div class="section col s12" v-if="people.length > 0 || households.length > 0">
        <h2 class="red-text">
            <!--<i class="material-icons medium red-text">error</i>-->
            Hang on!
        </h2>            
        <p>
          Before you do anything else, please correct these records. They are missing required information.
        </p>

          <div class="row">
            <div class="col m6 s12" v-if="people.length > 0">
              <div class="collection with-header">
                <div class="collection-header ">
                  <i class="material-icons tiny">people</i> 
                  People
                </div>
                <router-link :to="{ name: 'edit-person', params: { id: person._id } }" v-for="person in people" :key="person._id" title="Edit person" class="collection-item" >
                  {{ person._id }}
                  <span class="secondary-content">
                    <i class="material-icons">chevron_right</i>
                  </span>
                </router-link>
              </div><!--collection-->
            </div><!--col-->
            <div class="col m6 s12" v-if="households.length > 0">
              <div class="collection with-header">
                <div class="collection-header ">
                    <i class="material-icons tiny">home</i> 
                  Households
                </div>
                <router-link :to="{ name: 'edit-household', params: { id: household._id } }"  v-for="household in households" :key="household._id" title="Edit household" class="collection-item">
                  {{ household._id }}
                  <span class="secondary-content">
                    <i class="material-icons">chevron_right</i>
                  </span>
                </router-link>
              </div><!--collection-->    
            </div><!--col-->
          </div><!--row-->
        </div><!--section-->
    
        <p>
          <router-link :to="{name: 'add-household'}" class="btn">
            <i class="material-icons">add_location</i> Add household
          </router-link>      
          <router-link :to="{name: 'admin-reports'}" class="btn">
            <i class="material-icons">file_download</i> Build a report (CSV)
          </router-link>      
          </p>

        <div class="section col s12 hide">
          <div class="divider"></div>
          <h2>
            Actions
          </h2>
          <p>
            Beyond searching for and updating records in the membership list, you can also do these things:
          </p>
            <div class="row">
                <div class="col m4">
                  <div class="card blue-grey darken-1">
                    <div class="card-content white-text">
                      <span class="card-title">
                        <i class="material-icons small">add_location</i> 
                        Households
                      </span>
                      <p>
                        Search first. If you can't find 'em, go ahead and add 'em.
                      </p>
                    </div><!--content-->
                    <div class="card-action blue-grey darken-2">
                      <router-link :to="{name: 'add-household'}" class="">
                        Add household
                      </router-link>      
                    </div><!--actions-->
                  </div><!--card-->
                </div>
                <div class="col m4">
                    <div class="card blue-grey darken-1">
                      <div class="card-content white-text">
                        <span class="card-title">
                          <i class="material-icons small">email</i> 
                          Email blasts
                        </span>
                        <p>
                          For email blasts to groups in our membership.
                        </p>
                      </div><!--content-->
                      <div class="card-action blue-grey darken-2">
                        <router-link :to="{name: 'member-emails'}" class="">
                          Build email list
                        </router-link>      
                      </div><!--actions-->
                    </div><!--card-->
                  </div>
                  <div class="col m4">
                      <div class="card blue-grey darken-1">
                        <div class="card-content white-text">
                          <span class="card-title">
                            <i class="material-icons small">file_download</i>                            
                            Reports
                          </span>
                          <p>
                            Download the list for mailings &amp; other ad hoc reports.
                          </p>
                        </div><!--content-->
                        <div class="card-action blue-grey darken-2">
                          <router-link :to="{name: 'member-reports'}" class="">
                            Build report
                          </router-link>      
                        </div><!--actions-->
                      </div><!--card-->
                    </div>
              </div><!--row-->          

        </div><!--section-->



  </div>
</script>

<script type="text/x-template" id="admin-search">
  <div>
    <p v-if="items && items.length == 0">
      No results for {{ $route.query.q }}.
      <router-link :to="{name: 'add-household'}">
        <i class="material-icons tiny">add_box</i> Add household
      </router-link>    
    </p>
    <div v-else>

      <div class="row">
        <div class="col s12 m3">
          <h6>
            Filters
          </h6>

            <div v-for="(value, key) in counts" :key="key" class="collection with-header">
              <div class="collection-header">
                {{ key | capitalize }}
              </div>
              <a href="#" @click.prevent="addFacet(key, key2)" v-for="(value2, key2) in value" class="collection-item">{{ key2 }}
                <span class="count">({{ value2 }})</span>
              </a>
            </div>
    
        </div><!--col-->
        <div class="col s12 m9">
            <h6>
              Showing {{ items.length }} Results
            </h6>
    
            <ul class="collection">
                <li class="collection-item" v-for="item in items" v-bind:id="item._id" :key="item._id">    
                    <!-- if this link causes problems: https://github.com/vuejs/vue-router/issues/986 -->                    
                    <router-link :to="{name: 'admin-view-household', params: { id: item.household_id }}" title="view household">
                      <person-name :item="item"></person-name>
                    </router-link>

                    <!-- Dropdown Trigger -->
                    <a class='dropdown-trigger right' href='#' :data-target="'dropdown-' + item._id">
                      <i class="material-icons small">more_horiz</i>
                    </a>
                
                    <!-- Dropdown Structure -->
                    <ul :id="'dropdown-' + item._id" class='dropdown-content'>
                      <li>
                        <router-link :to="{ name: 'edit-person', params: { id: item._id } }" title="Edit person" class="">
                          <i class="material-icons tiny">person</i> Edit person
                        </router-link>
                      </li>
                      <li class="divider"></li>
                      <li>
                        <router-link :to="{ name: 'edit-household', params: { id: item.household._id } }" title="Edit household" class="">
                          <i class="material-icons tiny">home</i> Edit household
                        </router-link>
                      </li>
                    </ul>                    
                    
                  <div class="row">
                    <div class="col s12 m5">
                      <person-contact-info :item="item"></person-contact-info>      
                    </div>
                    <div class="col s12 m7">
                      <location :item="item.household"></location>
                    </div><!--col-->
                  </div>
                </li>
              </ul>

        </div><!--col-->
      </div><!--row-->
    </div><!-- velse -->
  </div>
</script>

<script type="text/x-template" id="admin-edit-household">
  <div>
    <pre class="hide">
      {{ item }}
    </pre>

    <div class="card">
      <form id="form-edit-household" name="form-edit-household" v-on:submit.prevent="save" action="#" method="post">
        <div class="card-content">
            <form-errors :errors="errors"></form-errors>
            <div class="row">
              <div class="input-field col m4 s12">
                <input type="text" id="household_name" v-model="item.name" class="validate" />
                <label for="household_name" class="active">Household name</label>
                <span class="helper-text red-text text-darken-2">Required</span>
              </div>
              <div class="input-field col m8 s12">
                <input type="text" id="household_label_name" v-model="item.label_name"  />
                <label for="household_label_name" class="active">Mailing label name</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col m8 s12">
                <input type="text" id="household_street1" v-model="item.street1"  />
                <label for="household_street1" class="active">Street 1</label>
              </div>
              <div class="input-field col m4 s12">
                <input type="text" id="household_street2" v-model="item.street2"  />
                <label for="household_street2" class="active">Street 2</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col m6 s12">
                <input type="text" id="household_city" v-model="item.city"  />
                <label for="household_city" class="active">City</label>
                <span class="helper-text red-text text-darken-2">Required</span>
              </div>
              <div class="input-field col m2 s12">
                <input type="text" id="household_state" v-model="item.state"  />
                <label for="household_state" class="active">State</label>
                <span class="helper-text red-text text-darken-2">Required</span>
              </div>
              <div class="input-field col m4 s12">
                <input type="text" id="household_zip" v-model="item.zip"  />
                <label for="household_zip" class="active">ZIP</label>
                <span class="helper-text red-text text-darken-2">Required</span>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12 m12">
                <input type="text" id="household_country" v-model="item.country"  />
                <label for="household_country" class="active">Country</label>
                <!-- <span class="helper-text red-text text-darken-2">Required</span> -->
              </div>
            </div>
            <div class="input-field">              
              <input type="text" id="household_phone" v-model="item.phone"  />
              <label for="household_phone" class="active">Household Phone</label>
            </div>
            <div class="section hide">
              <h5>
                Hardcopies
              </h5>
            </div>
            <div class="row hide">              
              <div class="col m6 s12 switch">
                Mail a hardcopy of the newsletter?<br />
                <label>
                  No
                  <input type="checkbox" id="mail_news" v-model="item.mail_news">
                  <span class="lever"></span>
                  Yes
                </label>
              </div>
              <div class="col m6 s12 switch">
                Mail a hardcopy of the membership list?<br />
                <label>
                  No
                  <input type="checkbox" id="mail_list" v-model="item.mail_list">
                  <span class="lever"></span>
                  Yes
                </label>
              </div>
            </div><!--row-->
          </div><!--card content-->
          <div class="card-content red lighten-4" v-if="$route.params.id">
            <label v-on:click="removeHousehold()" class="red-text text-darken-2">
              <input type="checkbox" v-bind:id="item._id" v-model="item._deleted" />
              <span>Remove this household</span>
            </label>
            <p>
              Only remove households that have been added in error. Deleting the household deletes the people in the household, too. This can not be undone.
            </p>
          </div><!-- card-content -->
          <div class="card-action grey lighten-4">
            <input type="hidden" v-model="item.household_id"  />
            <button id="save" class="btn btn-large waves-effect waves-light" type="submit" name="action">Submit</button>
            <router-link v-if="$route.name == 'edit-household'" :to="{name: 'admin-view-household', params: {id: item._id}}" class="waves-effect waves-light btn-flat grey-text" title="cancel changes, and return to the list">Cancel</router-link>
            <router-link v-if="$route.name == 'add-household'" :to="{name: 'admin'}" class="waves-effect waves-light btn-flat grey-text" title="cancel changes, and return to the list">Cancel</router-link>
          </div>
    </form>
  </div><!--card-->

  </div>
</script> 

<script type="text/x-template" id="admin-edit-person">
  <div>
    <pre class="hide">
      {{ item }}
    </pre>
    <div class="card">

        <form id="form-edit-person" name="form-edit-person" v-on:submit.prevent="save" action="#" method="post">
            <div class="card-content blue lighten-5">
          
              <form-errors :errors="errors"></form-errors>
  
              <div class="row">
                <div class="input-field col m6 s12">              
                  <input id="item_first" v-model="item.first" type="text" class="validate" />
                  <label for="item_first" class="active">First name</label>
                  <span class="helper-text red-text text-darken-2">Required</span>
                </div>
                <div class="input-field col m6 s12">              
                  <input id="item_last" v-model="item.last" type="text" class="validate" />
                  <label for="item_last" class="active">Last name</label>
                  <span class="helper-text red-text text-darken-2">Required</span>
                </div>
              </div>
              <div class="row">
                <div class="input-field col m12 s12">              
                  <input id="item_email" v-model="item.email" type="email" class="validate"  />
                  <label for="item_email" class="active">Email</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s6">              
                  <input id="item_phone" v-model="item.phone" type="text" class="validate" />
                  <label for="item_phone" class="active">Mobile phone</label>
                </div>
                <div class="input-field col s6">              
                  <input id="item_work_phone" v-model="item.work_phone" type="text" class="validate" />
                  <label for="item_work_phone" class="active">Work phone</label>
                </div>
              </div>
              <div class="row">
                <div class="col m6 s12">              
                  <p>
                    Membership status
                  </p>
                  <p v-for="(value, idx) in statuses">
                    <label v-bind:for="item._id + '-' + idx">
                      <input 
                        type="radio" 
                        :name="item._id + '-' + idx" 
                        :id="item._id + '-' + idx" 
                        :value="value" 
                        v-model="item.status" 
                        class="with-gap"
                      />
                      <span>{{ value }}</span>
                    </label>
                  </p>                
                </div>
                <div class="col m6 s12">              
                  <p>Gender</p>
                  <p v-for="(value, index) in genders">
                    <label :for="item._id + '-gender-' + index">
                      <input type="radio" 
                        :name="item._id + '-gender-' + index" 
                        :id="item._id + '-gender-' + index" 
                        :value="value" 
                        v-model="item.gender" 
                        class="with-gap"
                      />
                      <span>{{ value }}</span>
                    </label>
                  </p>                
                </div>
              </div><!-- row -->    
  
            </div><!--card-content-->
            <div v-if="$route.name != 'newPerson'" class="card-content red lighten-4">
              <p>
                <label v-on:click="removePerson()" class="red-text text-darken-2">
                  <input type="checkbox" v-bind:id="item._id" v-model="item._deleted" />
                  <span>Remove this person</span>
                </label>
              </p>
              <p>
                Only remove someone who has been added in error. This can not be undone.
              </p>
            </div><!-- card-content -->
  
            <div class="card-action grey lighten-4">
              <input type="hidden" v-model="item.household_id"  />
              <button id="save" class="btn btn-large waves-effect waves-light" type="submit">Submit</button>
              <router-link :to="{name: 'admin-view-household', params: {id: item.household_id}}" class="waves-effect waves-light btn-flat grey-text" title="cancel changes, and return to the list">Cancel</router-link>
            </div>
  
          </form>

    </div><!--card-->

  </div>
</script> 

<script type="text/x-template" id="admin-view-household">
  <div>
    <pre class="hide">
      {{ item }}
    </pre>
    <div class="row">
      <div class="col m5 s12">
        <h6>
          {{ item.name }}
        </h6>
          <location :item="item"></location>
          <p>
            <router-link :to="{ name: 'edit-household', params: { id: item._id } }" title="Edit household" class="">
              <i class="material-icons tiny">edit</i> Edit location            
            </router-link>
          </p>
      </div>
      <div class="col m7 s12">
        <ul class="collection">
          <li class="collection-item " v-for="item in item.people" v-bind:id="item._id" :key="item._id">    
              <!-- if this link causes problems: https://github.com/vuejs/vue-router/issues/986 -->
              <person-name :item="item"></person-name>
              <router-link :to="{ name: 'edit-person', params: { id: item._id } }" title="Edit person" class="right">
                <i class="material-icons tiny">edit</i> Edit
              </router-link>
            <div class="">
              <person-contact-info :item="item"></person-contact-info>      
            </div>
          </li>
        </ul>
        <p>
          <router-link :to="{name: 'add-person', params: {id: item._id}}" class="btn btn-small">
            <i class="material-icons tiny">person_add</i> Add person
          </router-link>
        </p>  
      </div>
    </div><!--row-->
  </div>
</script> 

<!-- report builder, child of admin -->
<script type="text/x-template" id="admin-reports">
  <div>
    <div class="row">
      <div class="col s12 m12">
        <p>
          Select statuses to prepare your report for download.
        </p>
        <a v-for="status in statuses" href="#" v-on:click.prevent="addStatusParam(status)" class="chip status-param nowrap blue-text" :class="{'blue darken-2, white-text': $route.query && $route.query.status && $route.query.status.indexOf(status) > -1}">
          <i class="material-icons tiny" v-if="$route.query && $route.query.status && $route.query.status.indexOf(status) > -1">
            check
          </i>
          <i class="material-icons tiny" v-else>
            add_circle
          </i>
          {{ status | capitalize }}
        </a>
        <router-link :to="{name: 'admin-reports'}" class="chip white red-text" v-if="$route.query && $route.query.status">
          <i class="material-icons tiny">
            clear
          </i>
          Clear
        </router-link>
      </div>
    </div>
    <div class="row" v-if="items.length > 0">
      <div class="col s12 m12">
        <h6>
          Report preview
        </h6>

        <div class="preview-container">
          <pre>{{ items }}</pre>
          <table class="responsive-table striped hide">
            <thead>
              <tr v-for="(person, index) in items.slice(0,1)">
                <th v-for="(value, key) in person">
                    {{ key }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(person, index) in items">
                <td v-for="(value, key) in person">
                    {{ value }}
                </td>
              </tr>
            </tbody>
          </table>
          <pre class="hide">{{ items }}</pre>
        </div>
        <p>
          <a :href="'/api/admin/csv?' + $route.fullPath.split('?')[1] " class="btn btn-small" v-if="items.length > 0">
            <i class="material-icons tiny">file_download</i> Download Report (CSV)
          </a>
        </p>    
      </div>
    </div><!--row-->
  </div>
</script>




<!-- MEMBERS VIEWS -->

<!--parent view of member section-->
<script type="text/x-template" id="members">
  <div>

      <div class="row">
        <div class="col s12">
          
          <h5 class="breadcrumbs">
            <span v-for="route in $route.matched">
                <span v-if="route.name != $route.name">
                  <router-link :to="{name: route.name}">
                    {{ route.meta.breadcrumb }}
                  </router-link> / 
                </span>
                <span v-else>
                  {{ route.meta.breadcrumb }}
                </span>
            </span>              
          </h5>
        
        </div><!--col-->
      </div><!--row-->

      <form action="#" @submit="search" v-if="searchForm">
        <div class="row">
          <div class="input-field col m11 s9">
            <input id="search" v-model="searchstring" type="text" />
            <label for="search">Search by name</label>
          </div>
          <div class="input-field col m1 s3">
            <button class="btn waves-effect waves-light" type="submit" name="action">
              <i class="material-icons" title="search">search</i>
            </button>
          </div>
        </div>
      </form>


      <error :error="error"></error>
      <loading :status="loading"></loading>        

    <router-view 
      @setSearchString="setSearchString" 
      @clicked="clickedFromChild"
      @searchForm="toggleSearchForm"
      :isAdmin="isAdmin"
      @loading="loadingCheck"
      @error="errorMsg"
      >
    </router-view>
  </div>
</script>

<!--list landing page, includes breakdown & recent updates, child of members-->
<script type="text/x-template" id="member-intro">
  <div>
    <div class="row">

      <div class="col m4 s12">
        <h5>
          Tally
        </h5>
        <table class="responsive striped counts">
          <thead class="hide">
            <tr>
              <th>
                Count
              </th>
              <th class="right-align">
                Status 
              </th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="status in statuses" :key="status.key">
              <td class="right-align">
                {{ status.value }}
              </td>
              <td class="">
                  <router-link :to="{name: 'member-search', query: {'drilldown': JSON.stringify(['status', status.key ]) }}">
                  {{ status.key }}
              </router-link>
              </td>
            </tr>
            <tr class="">
              <td class="right-align">
                {{ total }} 
              </td>
              <td>
                  Total (all)
              </td>
            </tr>
          </tbody>
        </table>
        <!-- doughnut chart commented out for now -->
        <!-- <canvas id="myChart"></canvas> -->
      </div>
      <div class="col m4 s12">
        <h5>
          Actions
        </h5>
        <ul class="collection">
          <li class="collection-item">
            <router-link :to="{name: 'member-emails'}">
              <i class="material-icons tiny">email</i> 
              Build a list of email addresses
            </router-link>
          </li>
          <li class="collection-item hide">
            <router-link :to="{name: 'member-reports'}">
              <i class="material-icons tiny">file_download</i> 
              Generate a report to download (CSV) 
            </router-link>
          </li>
        </ul>
      </div>
      <div class="col m4 s12">
        <h5>Recent updates</h5>
        <ol>
          <li v-for="update in updates">

            <div v-show="update.doc.type == 'household'">
              <router-link :to="{name:'member-household', params:{ id:update.id }}">{{ update.doc.name }}</router-link>
              <location v-bind:item="update.doc"></location>
            </div>

            <div v-show="update.doc.type == 'person'">
              <router-link :to="{name:'member-household', params:{ id:update.doc.household_id }}">
                <person-name v-bind:item="update.doc"></person-name>
              </router-link>
            </div>

          </li>
        </ol>
      </div>
    </div>
  </div>
</script>

<!--search results, child of members-->
<script type="text/x-template" id="member-search">
  <div>
    <p v-if="items && items.length == 0">
      No results for {{ $route.query.q }}.
    </p>
    <div v-else>
        <div class="row">
          <div class="col s12 m3">
              <h6>
                Filters
              </h6>
    
                <div v-for="(value, key) in counts" :key="key" class="collection with-header">
                  <div class="collection-header">
                    {{ key | capitalize }}
                  </div>
                  <a href="#" @click.prevent="addFacet(key, key2)" v-for="(value2, key2) in value" class="collection-item" v-if="Object.keys(value).length > 1">
                    {{ key2 | capitalize }}
                    <span class="count">({{ value2 }})</span>
                  </a>
                  <div v-else class="collection-item" :class="{ 'active': Object.keys(value).length == 1 }">
                    {{ Object.keys(value)[0] | capitalize }}
                  </div>
                </div>
        
            </div><!--col-->
            <div class="col s12 m9">
                <h6>
                  Showing {{ items.length }} Results
                </h6>
        
                <ul class="collection">
                    <li class="collection-item" v-for="item in items" v-bind:id="item._id" :key="item._id">    
                        <!-- if this link causes problems: https://github.com/vuejs/vue-router/issues/986 -->                    
                        <router-link :to="{name: 'member-household', params: { id: item.household_id }}" title="view household">
                          <person-name :item="item"></person-name>
                        </router-link>
                            
                      <div class="row">
                        <div class="col s12 m5">
                          <person-contact-info :item="item"></person-contact-info>      
                        </div>
                        <div class="col s12 m7">
                          <location :item="item.household"></location>
                        </div><!--col-->
                      </div>
                    </li>
                  </ul>
    
            </div><!--col-->
          </div><!--row-->
        </div><!-- velse -->

  </div>
</script>

<!-- email list builder, child of members -->
<script type="text/x-template" id="member-emails">
  <div>
        <div class="row">
          <div class="col s12 m12">
            <!--
            <div class="">
              <p>
                Group filters
              </p>
              <div class="">
                <p>
                  <router-link :to="{query: { status: newsletter }}" class="btn-small" :title="'emails for ' + newsletter">Newsletter emails</router-link>
                </p>
                <p>
                  <router-link :to="{query: { status: statuses }}" class="btn-small" :title="'emails for ' + statuses">All emails</router-link>
                </p>
              </div>  

              
              
              // WHAT IS THIS AND CAN WE USE IT IN REPORTS?
              v-if="!query_array.includes(status.key)"


            -->
                <p>
                  Select statuses to build your email list.
                </p>
                <div>
                <a v-for="status in statuses" @click.prevent="intercept(status.key)" href="#" class="chip status-param nowrap blue-text" :class="{'blue darken-2, white-text': $route.query && $route.query.status && $route.query.status.indexOf(status.key) > -1}">
                  <i class="material-icons tiny" v-if="$route.query && $route.query.status && $route.query.status.indexOf(status.key) > -1">
                    check
                  </i>
                  <i class="material-icons tiny" v-else>
                    add_circle
                  </i>
                  {{ status.key | capitalize }} ({{ status.value }})
                </a>
                <router-link :to="{name: 'member-emails'}" class="chip white red-text" v-if="$route.query && $route.query.status">
                  <i class="material-icons tiny">
                    clear
                  </i>
                  Clear
                </router-link>
              </div>
            </div><!--col-->
          </div><!--row-->

          <div class="row">

              <div class="col s12 m12" v-if="items.length > 0">
                  <h6>
                    Email addresses
                  </h6>
                  <p>
                    Select and copy these emails, and paste them into your email application.
                  </p>
                  <div class="preview-container">
                    <form>
                      <div class="input-field">
                        <textarea id="textarea-emails" v-model="items" class="materialize-textarea">{{ items }}</textarea>
                      </div>
                    </form>
                  </div>
              </div>

        </div><!-- row -->

  </div>
</script>

<!-- report builder, child of members -->
<script type="text/x-template" id="member-reports">
  <div>
    <div class="row">
      <div class="col s12 m12">
        <p>
          Select statuses to prepare your report for download.
        </p>
        <a v-for="status in statuses" href="#" v-on:click.prevent="addStatusParam(status)" class="chip status-param nowrap blue-text" :class="{'blue darken-2, white-text': $route.query && $route.query.status && $route.query.status.indexOf(status) > -1}">
          <i class="material-icons tiny" v-if="$route.query && $route.query.status && $route.query.status.indexOf(status) > -1">
            check
          </i>
          <i class="material-icons tiny" v-else>
            add_circle
          </i>
          {{ status | capitalize }}
        </a>
        <router-link :to="{name: 'member-reports'}" class="chip white red-text" v-if="$route.query && $route.query.status">
          <i class="material-icons tiny">
            clear
          </i>
          Clear
        </router-link>
      </div>
    </div>
    <div class="row" v-if="items.length > 0">
      <div class="col s12 m12">
        <h6>
          Report preview ({{ items.length }} records)
        </h6>

        <div class="preview-container">
          <table class="responsive-table striped">
            <thead>
              <tr v-for="(person, index) in items.slice(0,1)">
                <th v-for="(value, key) in person">
                    {{ key }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(person, index) in items">
                <td v-for="(value, key) in person">
                    {{ value }}
                </td>
              </tr>
            </tbody>
          </table>
          <pre class="hide">{{ items }}</pre>
        </div>
        <p>
          <a :href="'/api/member/csv?' + $route.fullPath.split('?')[1] " class="btn btn-small" v-if="items.length > 0">
            <i class="material-icons tiny">file_download</i> Download Report (CSV)
          </a>
        </p>    
      </div>
    </div><!--row-->
  </div>
</script>


<!-- household landing page, child of members -->
<script type="text/x-template" id="member-household">
      <div>
        <div class="card">
          <div class="card-content">
            <span class="card-title">
              {{ item.label_name }}
            </span>
            <location v-bind:item="item"></location>
            <ul class="collection">
              <person 
                v-for="person in item.people" 
                v-bind:key="person._id" 
                v-bind:item="person">
              </person>
            </ul>
          </div>
        </div>
        <div class="">
          <router-link :to="back">&larr; Back</router-link>
        </div>
      </div>
</script>

<!-- holds actions like download, search, email; used in member templates -->
<script type="text/x-template" id="dropdown">
  <span>
    <!-- Dropdown Trigger -->
    <a class='dropdown-trigger' href='#' :data-target="'dropdown-' + status">
      <i class="material-icons small">more_horiz</i>
    </a>

    <!-- Dropdown Structure -->
    <ul :id="'dropdown-' + status" class='dropdown-content'>
      <li v-if="isAdmin">
        <a :href="'/api/member/csv/' + status">
          <i class="material-icons">file_download</i> Download {{ status }} info (CSV)
        </a>
      </li>
      <li class="divider" tabindex="-1"></li>
      <li>
        <router-link v-if="status != 'all'" :to="{name: 'member-emails', query:{ status:status }}" :title="'View ' + status + ' emails'">
            <i class="material-icons">email</i> View {{ status }} member emails
          </router-link>            
          <router-link v-else :to="{name: 'member-emails', query:{ status:statuses_array }}" :title="'View ' + status + ' emails'">
              <i class="material-icons">email</i> View {{ status }} member emails
            </router-link>            
          </li>
    </ul>
  </span>
</script>
  


  <!-- RESOURCES VIEWS-->

  <!--Resources (Google Drive)-->
  <script type="text/x-template" id="resources">
    <div>
      <div class="row">
        <div class="col s12">
        </div>
      </div>
      <div class="row">
        <div class="col s12">
          <h5>Resources&nbsp;<i class="material-icons small cursor-pointer hoverable" @click="onHelp($event)">help_outline</i></h5>
        </div>
      </div>
      <div id="resourcesHelp" class="row">
        <div class="col s12">
            <p>Resources files are organized in folders by topic. PDF files can be viewed and all files can be downloaded.</p>
            <ul>
              <li><i class="material-icons">chevron_right</i>Select a folder to display the files and additional folders contained in it.</li>
              <li><i class="material-icons">chevron_right</i>Select a PDF file to view the contents.</li>
              <li><i class="material-icons">chevron_right</i>Click the <i class="material-icons">file_download</i> icon to download a file.</li>
              <li><i class="material-icons">chevron_right</i>Use the breadcrumbs at the top of the list tomove up in the folder hierarchy.</li>
            </ul>
            <a class="waves-effect waves-light btn blue" @click="onHelp($event)"><i class="material-icons left">arrow_drop_up</i>Close</a>
        </div>
      </div>
            <!-- <div class="row"> -->
        <!-- <div class="col s12">
          <h5>Resources&nbsp;<i class="material-icons small waves-effect waves-light btn modal-trigger" href="resourcesHelpmodal">help_outline</i></h5>
        </div> -->
        <!-- <div class="col s8">
          <nav class="grey lighten-4">
            <div class="nav-wrapper">
              <form>
                <div class="input-field">
                  <input id="search" type="search" placeholder="Search resources"  v-on:keyup.enter="onSearch($event)" required>
                  <label class="label-icon" for="search"><i class="material-icons  black-text">search</i></label>
                  <i class="material-icons">close</i>
                </div>
              </form>
            </div>
          </nav>
        </div> -->
      <!-- </div> -->
      <nav class="blue darken-2">
        <div class="nav-wrapper">
          <div class="col s12">
            <span v-for="folder in path" @click="onBreadcrumb(folder.id, $event)" class="breadcrumb cursor-pointer">{{folder.name}}</span>
          </div>
        </div>
      </nav>
      <div class="row">
        <div class="col s12">
          <div class="divider"></div>
        </div>
      </div>
      <div v-if="files.length==0">
        <div class="row">
            <div class="col s12"><i class="material-icons small">info_outline</i><span>&nbsp;No files in this folder</span></div>
        </div>
      </div>
      <div v-else>
        <div class="row grey lighten-4">
          <div class="col s5">Name</div>
          <div class="col s1">Type</div>
          <div class="col s2">Modified</div>
          <div class="col s2">Size</div>
          <div class="col s1"></div>
        </div>
        </div>
        <div class="row"  v-for="file in files" :key="file.id" v-if="file.type=='Folder'">
          <div class="col s5" @click="onFolderView(file,$event)"><i class="material-icons small cursor-pointer">folder</i><span class="cursor-pointer">&nbsp;{{file.name}}</span></div>
          <div class="col s1">&minus;</div>
          <div class="col s2">&minus;</div>
          <div class="col s2">&minus;</div>
          <div class="col s1"></div>
        </div>
        <div class="row"  v-for="file in files" :key="file.id" v-if="file.type!='Folder'">
          <div class="col s5" v-bind:class="{'cursor-pointer':file.type=='PDF','hoverable':file.type=='PDF'}" @click="(file.canView?onFileView(file, $event):null)"><i class="material-icons small">{{(file.type=='PDF'?'description':(file.type=='Spreadsheet'?'grid_on':'format_align_left'))}}</i><span>&nbsp;{{file.name + (!file.canView?'&nbsp;(Download only)':'')}}</span></div>
          <div class="col s1">{{file.type}}</div>
          <div class="col s2">{{file.modifiedTimeFormatted}}</div>
          <div class="col s2" v-html="file.sizeFormatted"></div>
          <div class="col s1"><i v-if="file.canDownload" class="material-icons small cursor-pointer hoverable" @click="onFileDownload(file, $event)">file_download</i></div>
        </div>
      </div>
    </div>
  </script>

  <!--Resources: PDF viewer for Google Docs-->
  <div id="pdfModal" class="modal">
    <iframe id="pdfViewer" name="pdfViewer" src="vendor/pdfjs/web/viewer.html" allowfullscreen="true"
      webkitallowfullscreen=""></iframe>
  </div>

  <!--SHARED VIEWS-->
  <script type="text/x-template" id="error">
    <div v-if="error">
      <div class="alert error card">
        <div class="card-content red white-text">
          <h6>
            <i class="material-icons">error</i> Sorry, there was an error. 
          </h6>
          <p>
            Please copy what's below and send it to Brad Noble:
          </p>
          <dl v-if="error.ok==false">
            <dt>
              Cloudant error: {{ error.status }} {{ error.statusText }}
            </dt>
            <dd v-if="error.body">
              {{ error.body.error }}
            </dd>
            <dd>
              {{ error.url }}
            </dd>
            <dd>
              {{ error.headers.map.date[0] }}
            </dd>
          </dl>
          <p v-else>
              {{ error }}
              {{ $route }}
          </p>
        </div>      
      </div>
    </div>
  </script>

  <script type="text/x-template" id="loading">
      <div v-if="status" >
        <div class="progress">
          <div class="indeterminate"></div>
        </div>
      </div>
    </script>

  <script type="text/x-template" id="form-errors">
      <div v-if="errors.length > 0">
        <ul class="errors">
          <li v-for="error in errors" class="red-text text-darken-2">
            <i class="material-icons red-text text-darken-2">error</i> {{ error }}
          </li>
        </ul>
      </div>
  </script>

  <script type="text/x-template" id="view-location">
    <span>
      <!-- <span v-if="item.label_name"><b>{{ item.label_name}}</b><br /></span> -->
      <span v-if="item.street1">{{ item.street1 }}</span><span v-if="item.street2">, {{ item.street2 }}</span><span v-if="item.city">, {{ item.city }}</span><span v-if="item.state">, {{ item.state }}</span><span v-if="item.zip">&nbsp;{{ item.zip }}</span> 
      <div v-if="item.country">
        {{ item.country }}
      </div>
      <div v-if="item.phone" class="nowrap">
        <i class="material-icons tiny grey-text">home</i> {{ item.phone }}
      </div> 
    </span>
  </script>

  <script type="text/x-template" id="view-person">
    <li class="row collection-item">
      <div class="col m6"><person-name :item="item"></person-name></div>
      <div class="col m6"><person-contact-info :item="item"></person-contact-info></div>
    </li>
  </script>

  <script type="text/x-template" id="view-person-name">
    <span>
      <span class="name">{{ item.last }}, {{ item.first }}</span>
      <span class="person-status grey-text">{{ item.status }}</span>
    </span>
  </script>

  <script type="text/x-template" id="view-person-contact-info">
  <span>
    <div v-if="item.email" class="nowrap"><i class="material-icons tiny grey-text">email</i>&nbsp;{{ item.email }}</div>
    <div v-if="item.phone" class="nowrap"><i class="material-icons tiny grey-text">phone_iphone</i>&nbsp;{{ item.phone }}</div>
    <div v-if="item.work_phone" class="nowrap"><i class="material-icons tiny grey-text">work</i>&nbsp;{{ item.work_phone }}</div>
  </span>
  </script>



  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="vendor/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="vendor/materialize/js/materialize.min.js"></script>
  <!--PDF viewer for Resources-->
  <script type="text/javascript" src="vendor/pdfjs/build/pdf.js"></script>
  <script type="text/javascript" src="vendor/pdfjs/web/viewer.js"></script>
  <!--Twitter widget loader-->
  <script type="text/javascript" src="vendor/twitter-widgets/index.js"></script>
  <!--MSC-->
  <script type="text/javascript" src="factories.js"></script>
  <script type="text/javascript" src="routes.js"></script>
  <script type="text/javascript" src="main.js"></script>

  <script type="text/javascript">
    $(document).ready(function(){
      $('.sidenav').sidenav();
    });
  </script>
</body>

</html>